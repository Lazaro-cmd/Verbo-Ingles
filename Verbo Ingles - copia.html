<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verbo Inglés · Canvas</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{ --bg:#0b0f14; --card:#111826; --muted:#9aa4b2; --fg:#e5eef7; --brand:#4f8cff; --brand-2:#22d3ee; --ok:#10b981; --warn:#f59e0b; --danger:#ef4444; --shadow:0 10px 25px rgba(0,0,0,.35);} *{box-sizing:border-box} html,body{height:100%} body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:radial-gradient(1200px 700px at 10% -10%, rgba(79,140,255,.12), transparent), radial-gradient(800px 500px at 120% 10%, rgba(34,211,238,.12), transparent), var(--bg); color:var(--fg)} a{color:var(--brand)} .wrap{min-height:100%; display:grid; grid-template-rows:auto 1fr auto}
    header{display:flex; gap:12px; align-items:center; justify-content:space-between; padding:14px 18px; position:sticky; top:0; backdrop-filter:saturate(160%) blur(8px); background:linear-gradient(to bottom, rgba(17,24,38,.85), rgba(17,24,38,.55)); border-bottom:1px solid rgba(255,255,255,.06); z-index:5}
    .logo{display:flex; gap:10px; align-items:center; font-weight:700}
    .logo .dot{width:10px;height:10px;border-radius:999px;background:conic-gradient(var(--brand),var(--brand-2)); box-shadow:0 0 12px rgba(79,140,255,.8)}
    .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .search{display:flex; align-items:center; gap:8px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); padding:8px 10px; border-radius:10px; min-width:260px}
    .search input{all:unset; color:var(--fg); width:220px}
    .search .clear{all:unset; cursor:pointer; padding:6px; border-radius:8px}
    .search .clear:hover{background:rgba(255,255,255,.08)}
    .accent{display:flex; gap:8px; align-items:center; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); padding:6px 8px; border-radius:10px}
    .accent input{display:none}
    .accent label{display:flex; align-items:center; gap:6px; padding:6px 8px; border-radius:8px; cursor:pointer; color:var(--muted); border:1px solid transparent}
    .accent input:checked + label{color:var(--fg); background:rgba(79,140,255,.15); border-color:rgba(79,140,255,.35)}
    .flag{width:18px; height:12px; border-radius:2px; overflow:hidden; box-shadow:0 0 0 1px rgba(255,255,255,.2) inset}
    .flag.us{background:linear-gradient(#b22234 50%, #fff 50%), repeating-linear-gradient(#b22234, #b22234 7.7%, #fff 7.7%, #fff 15.4%)}
    .flag.uk{background:conic-gradient(#00247d 0 25%, #cf142b 0 50%, #fff 0 75%, #00247d 0 100%)}
    .stats{display:flex; gap:10px; align-items:center}
    .pill{font-size:12px; letter-spacing:.12em; padding:.25rem .5rem; border-radius:999px; background:rgba(255,255,255,.06); color:var(--muted); border:1px solid rgba(255,255,255,.08)}
    main{display:grid; place-items:center; padding:18px}
    .grid{display:grid; grid-template-columns:1fr; gap:18px; width:min(980px, 100%)}
    .progress{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:10px}
    .progress .bar{height:10px; background:linear-gradient(90deg, var(--brand), var(--brand-2)); width:0%; border-radius:999px; box-shadow:var(--shadow); transition:width .35s ease}
    .card{position:relative; perspective:1200px; height:420px}
    .flip{width:100%; height:100%; position:relative; transform-style:preserve-3d; transition:transform .6s cubic-bezier(.2,.8,.2,1)}
    .card.show-back .flip{transform:rotateY(180deg)}
    .face{position:absolute; inset:0; backface-visibility:hidden; border-radius:16px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow); padding:18px}
    .back{transform:rotateY(180deg)}
    h2{margin:.1em 0 .2em; font-size:34px}
    .muted{color:var(--muted)}
    .actions{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .btn{all:unset; display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; cursor:pointer; background:rgba(79,140,255,.12); color:#dbe7ff; border:1px solid rgba(79,140,255,.35)}
    .btn.secondary{background:rgba(255,255,255,.06); border-color:rgba(255,255,255,.12); color:var(--fg)}
    .btn.ghost{background:transparent; border-color:transparent; color:var(--muted)}
    .btn:hover{filter:brightness(1.08)}
    .kbd{font:600 12px/1 Inter; padding:4px 6px; border-radius:6px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1)}
    footer{padding:18px; text-align:center; color:var(--muted)}
    @media (max-width:640px){ .card{height:460px} h2{font-size:28px} }
    /* Modo oscuro automático */
    @media (prefers-color-scheme: light){:root{--bg:#f6f8fc;--card:#ffffff;--fg:#0b0f14;--muted:#5c6674} body{background:radial-gradient(1200px 700px at 10% -10%, rgba(79,140,255,.06), transparent), radial-gradient(800px 500px at 120% 10%, rgba(34,211,238,.06), transparent), var(--bg)} }
    /* Nuevos elementos */
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .seg{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:6px 8px;display:flex;gap:8px;align-items:center}
    .seg label{font-size:12px;color:var(--muted)}
    .meter{height:8px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .meter i{display:block;height:100%;background:linear-gradient(90deg,var(--ok),var(--brand-2));width:0%}
    textarea.note{width:100%;min-height:80px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:10px;color:var(--fg)}
    .chip{font-size:11px;padding:.2rem .45rem;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo"><span class="dot" aria-hidden="true"></span> Verbo Inglés</div>
      <div class="toolbar" role="toolbar" aria-label="Controles principales">
        <div class="search" role="search">
          <svg fill="none" height="16" viewBox="0 0 24 24" width="16" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="#9aa4b2" stroke-linecap="round" stroke-width="2"></path><circle cx="11" cy="11" r="7" stroke="#9aa4b2" stroke-width="2"></circle></svg>
          <input id="q" placeholder="Buscar: base, pasado, participio, traducción…" aria-label="Buscar verbos" />
          <button class="clear" id="clear" title="Limpiar búsqueda" aria-label="Limpiar búsqueda">✕</button>
        </div>
        <div class="accent" role="group" aria-label="Acento">
          <input checked id="acc-us" name="accent" type="radio" value="us" />
          <label for="acc-us"><span class="flag us" aria-hidden="true"></span> US</label>
          <input id="acc-uk" name="accent" type="radio" value="uk" />
          <label for="acc-uk"><span class="flag uk" aria-hidden="true"></span> UK</label>
        </div>
        <div class="row" aria-label="Filtros">
          <div class="seg"><label for="f-group">Grupo</label>
            <select id="f-group" aria-label="Filtrar por grupo">
              <option value="">Todos</option>
              <option value="A-B">A-B</option>
              <option value="C-D">C-D</option>
              <option value="irregular">Irregular</option>
            </select>
          </div>
          <div class="seg"><label for="f-freq">Frecuencia</label>
            <select id="f-freq" aria-label="Filtrar por frecuencia">
              <option value="">Todas</option>
              <option value="alta">Alta</option>
              <option value="media">Media</option>
              <option value="baja">Baja</option>
            </select>
          </div>
          <div class="seg"><label for="f-cefr">Nivel MCER</label>
            <select id="f-cefr" aria-label="Filtrar por nivel MCER">
              <option value="">Todos</option>
              <option value="A1">A1</option>
              <option value="A2">A2</option>
              <option value="B1">B1</option>
              <option value="B2">B2</option>
              <option value="C1">C1</option>
              <option value="C2">C2</option>
            </select>
          </div>
          <div class="seg"><label><input type="checkbox" id="hide-learned" /> Ocultar aprendidos</label></div>
        </div>
        <div class="stats" role="status" aria-live="polite">
          <span class="pill">Estudiados <span id="studied">0</span>/<span id="total">0</span></span>
          <span class="pill">Progreso <span id="percent">0%</span></span>
          <span class="pill" title="Tiempo de estudio">⏱ <span id="studyTime">00:00</span></span>
        </div>
      </div>
    </header>
    <main>
      <div class="grid">
        <div class="progress" aria-label="Barra de progreso">
          <div class="bar" id="bar" style="width:0%"></div>
        </div>
        <section aria-live="polite" class="card" id="card">
          <div class="flip">
            <article class="face front" id="front"></article>
            <article class="face back" id="back"></article>
          </div>
        </section>
        <div class="actions">
          <button class="btn" id="prev" title="Anterior (←)">← Anterior</button>
          <button class="btn" id="next" title="Siguiente (→)">Siguiente →</button>
          <button class="btn secondary" id="flip" title="Voltear (Espacio)">Voltear tarjeta</button>
          <button class="btn secondary" id="rand" title="Aleatorio (R)">Aleatorio</button>
          <button class="btn" id="favBtn" title="Marcar favorito (A)">⭐ Favorito</button>
          <button class="btn ghost" id="audioAll" title="Reproducir pronunciaciones">🔊 Escuchar</button>
        </div>
        <details open>
          <summary class="pill">Ayuda e instrucciones</summary>
          <div class="muted">
            • Teclas: ← anterior, → siguiente, Espacio voltea, R aleatorio, A favorito.
            • Busca por verbo, significado, pasado o participio.
            • Cambia el acento (US/UK) para IPA y audio.
            • Progreso en tiempo real y barra visual. Favoritos se guardan localmente.
          </div>
        </details>
      </div>
    </main>
    <footer>Hecho con ♥ — aprendizaje de verbos irregulares</footer>
  </div>
  <script>
    const $ = s=>document.querySelector(s);
    const front = $('#front'), back = $('#back'), bar = $('#bar'), studiedEl=$('#studied'), totalEl=$('#total'), percentEl=$('#percent'), card=$('#card'), favBtn=$('#favBtn');

    // Datos con metadatos extra
    const verbs = [
      { base:'be', past:'was/were', part:'been', meaning:'ser/estar', ipa_us:'/biː/', ipa_uk:'/biː/',
        audio_us_base:'', audio_uk_base:'', audio_us_past:'', audio_uk_past:'', audio_us_part:'', audio_uk_part:'',
        group:'A-B', freq:'alta', cefr:'A1' },
      { base:'begin', past:'began', part:'begun', meaning:'empezar', ipa_us:'/bɪˈɡɪn/', ipa_uk:'/bɪˈɡɪn/',
        audio_us_base:'', audio_uk_base:'', audio_us_past:'', audio_uk_past:'', audio_us_part:'', audio_uk_part:'',
        group:'A-B', freq:'media', cefr:'A2' }
    ];

    // Estado ampliado y persistencia
    const state = {
      idx: 0,
      filtered: [...verbs],
      shown: JSON.parse(localStorage.getItem('vi:shown')||'[]'),
      favorites: new Set(JSON.parse(localStorage.getItem('vi:favs')||'[]')),
      audioHandles: [],
      reps: JSON.parse(localStorage.getItem('vi:reps')||'{}'),
      stats: JSON.parse(localStorage.getItem('vi:stats')||'{}'), // por verbo: {correct, wrong}
      notes: JSON.parse(localStorage.getItem('vi:notes')||'{}'),
      learned: new Set(JSON.parse(localStorage.getItem('vi:learned')||'[]')),
      startTs: Number(localStorage.getItem('
